{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{API_URL}from\"../../config\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const ProfileForm=_ref=>{let{showPForm}=_ref;const[userDetails,setUserDetails]=useState({});const[updatedDetails,setUpdatedDetails]=useState({});const editMode=showPForm;const navigate=useNavigate();useEffect(()=>{const authtoken=sessionStorage.getItem(\"auth-token\");if(!authtoken){navigate(\"/login\");}else{fetchUserProfile();}},[navigate]);const fetchUserProfile=async()=>{try{const authtoken=sessionStorage.getItem(\"auth-token\");const email=sessionStorage.getItem(\"email\");// Get the email from session storage\nif(!authtoken){navigate(\"/login\");}else{const response=await fetch(\"\".concat(API_URL,\"/api/auth/user\"),{headers:{\"Authorization\":\"Bearer \".concat(authtoken),\"Email\":email// Add the email to the headers\n}});if(response.ok){const user=await response.json();sessionStorage.setItem(\"name\",user.name);sessionStorage.setItem(\"phone\",user.phone);sessionStorage.setItem(\"email\",user.email);setUserDetails(user);setUpdatedDetails(user);}else{// Handle error case\nthrow new Error(\"Failed to fetch user profile\");}}}catch(error){console.error(error);// Handle error case\n}};const handleInputChange=e=>{setUpdatedDetails({...updatedDetails,[e.target.name]:e.target.value});};const handleSubmit=async e=>{e.preventDefault();try{const authtoken=sessionStorage.getItem(\"auth-token\");const email=sessionStorage.getItem(\"email\");// Get the email from session storage\nif(!authtoken||!email){navigate(\"/login\");return;}const payload={...updatedDetails};const response=await fetch(\"\".concat(API_URL,\"/api/auth/user\"),{method:\"PUT\",headers:{\"Authorization\":\"Bearer \".concat(authtoken),\"Content-Type\":\"application/json\",\"Email\":email},body:JSON.stringify(payload)});if(response.ok){// Update the user details in session storage\nsessionStorage.setItem(\"name\",updatedDetails.name);sessionStorage.setItem(\"phone\",updatedDetails.phone);setUserDetails(updatedDetails);// setEditMode(false);\n// Display success message to the user\nalert(\"Profile Updated Successfully!\");navigate(\"/\");window.location.reload();}else{// Handle error case\nthrow new Error(\"Failed to update profile\");}}catch(error){console.error(error);// Handle error case\n}};return/*#__PURE__*/_jsx(\"div\",{className:\"profile-container\",children:editMode&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 p-3\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group mb-3\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"label\",{htmlFor:\"email\",children:/*#__PURE__*/_jsx(\"span\",{className:\" text-capitalize\",children:\"Email\"})})}),/*#__PURE__*/_jsx(\"input\",{onChange:handleInputChange,id:\"email\",name:\"email\",type:\"email\",className:\"form-control\",defaultValue:userDetails.email})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group mb-3\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"label\",{htmlFor:\"phone\",children:/*#__PURE__*/_jsx(\"span\",{className:\" text-capitalize\",children:\"Phone\"})})}),/*#__PURE__*/_jsx(\"input\",{onChange:handleInputChange,id:\"phone\",name:\"phone\",type:\"tel\",className:\"form-control\",defaultValue:userDetails.phone})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group mb-3\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"label\",{htmlFor:\"name\",children:/*#__PURE__*/_jsx(\"span\",{className:\" text-capitalize\",children:\"Name\"})})}),/*#__PURE__*/_jsx(\"input\",{onChange:handleInputChange,id:\"name\",name:\"name\",type:\"text\",className:\"form-control\",defaultValue:userDetails.name})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Save\"})]})})});};export default ProfileForm;","map":{"version":3,"names":["React","useEffect","useState","API_URL","useNavigate","jsx","_jsx","jsxs","_jsxs","ProfileForm","_ref","showPForm","userDetails","setUserDetails","updatedDetails","setUpdatedDetails","editMode","navigate","authtoken","sessionStorage","getItem","fetchUserProfile","email","response","fetch","concat","headers","ok","user","json","setItem","name","phone","Error","error","console","handleInputChange","e","target","value","handleSubmit","preventDefault","payload","method","body","JSON","stringify","alert","window","location","reload","className","children","onSubmit","htmlFor","onChange","id","type","defaultValue"],"sources":["/home/project/StayHealthy/stay-healthy/src/Components/ProfileCard/ProfileForm.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { API_URL } from \"../../config\";\nimport { useNavigate } from \"react-router-dom\";\n\n\nconst ProfileForm = ({showPForm}) => {\n    const [userDetails, setUserDetails] = useState({});\n    const [updatedDetails, setUpdatedDetails] = useState({});    \n    const editMode=showPForm;\n    const navigate = useNavigate();\n\n    useEffect(() => {\n        const authtoken = sessionStorage.getItem(\"auth-token\");\n        if (!authtoken) {\n        navigate(\"/login\");\n        } else {\n        fetchUserProfile();        \n        }\n    }, [navigate]);\n\n    const fetchUserProfile = async () => {\n    try {\n      const authtoken = sessionStorage.getItem(\"auth-token\");\n      const email = sessionStorage.getItem(\"email\"); // Get the email from session storage\n\n        if (!authtoken) {\n            navigate(\"/login\");\n        } \n        else {\n            const response = await fetch(`${API_URL}/api/auth/user`, {\n            headers: {\n                \"Authorization\": `Bearer ${authtoken}`,\n                \"Email\": email, // Add the email to the headers\n            },\n        });\n        if (response.ok) {\n            const user = await response.json();\n            sessionStorage.setItem(\"name\", user.name);\n            sessionStorage.setItem(\"phone\", user.phone);\n            sessionStorage.setItem(\"email\", user.email);\n            setUserDetails(user);\n            setUpdatedDetails(user);            \n        } \n        else {\n            // Handle error case\n            throw new Error(\"Failed to fetch user profile\");\n            }\n        }\n    } catch (error) {\n        console.error(error);\n        // Handle error case\n    }\n    };\n\n    const handleInputChange = (e) => {\n        setUpdatedDetails({\n            ...updatedDetails,\n            [e.target.name]: e.target.value,\n        });\n    };\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        try {\n            const authtoken = sessionStorage.getItem(\"auth-token\");\n            const email = sessionStorage.getItem(\"email\"); // Get the email from session storage\n            if (!authtoken || !email) {\n                navigate(\"/login\");\n                return;\n            }\n            const payload = { ...updatedDetails };\n            const response = await fetch(`${API_URL}/api/auth/user`, {\n                method: \"PUT\",\n                headers: {\n                    \"Authorization\": `Bearer ${authtoken}`,\n                    \"Content-Type\": \"application/json\",\n                    \"Email\": email,\n                },\n                body: JSON.stringify(payload),\n            });\n            if (response.ok) {\n                // Update the user details in session storage\n                sessionStorage.setItem(\"name\", updatedDetails.name);\n                sessionStorage.setItem(\"phone\", updatedDetails.phone);\n                setUserDetails(updatedDetails);\n                // setEditMode(false);\n                // Display success message to the user\n                alert(`Profile Updated Successfully!`);\n                navigate(\"/\");\n                window.location.reload()\n            } else {\n                // Handle error case\n                throw new Error(\"Failed to update profile\");\n            }\n        } catch (error) {\n            console.error(error);\n            // Handle error case\n        }\n    };\n\n\nreturn (\n    <div className=\"profile-container\">\n    {editMode && \n        (<div className=\"mt-4 p-3\">\n            <form className=\"\" onSubmit={handleSubmit}>\n                <div className=\"form-group mb-3\">   \n                    <div>\n                        <label htmlFor=\"email\">\n                            <span className=\" text-capitalize\">Email</span>\n                        </label>\n                    </div>             \n                    <input onChange={handleInputChange} id=\"email\" name=\"email\" type=\"email\" className=\"form-control\" defaultValue={userDetails.email}/>\n                </div>\n                <div className=\"form-group mb-3\">   \n                    <div>\n                        <label htmlFor=\"phone\">\n                            <span className=\" text-capitalize\">Phone</span>\n                        </label>\n                    </div>             \n                    <input onChange={handleInputChange} id=\"phone\" name=\"phone\" type=\"tel\" className=\"form-control\" defaultValue={userDetails.phone} />\n                </div>\n                <div className=\"form-group mb-3\">   \n                    <div>\n                        <label htmlFor=\"name\">\n                            <span className=\" text-capitalize\">Name</span>\n                        </label>\n                    </div>             \n                    <input onChange={handleInputChange} id=\"name\" name=\"name\" type=\"text\" className=\"form-control\" defaultValue={userDetails.name} />\n                </div>\n                <button type=\"submit\">Save</button>\n            </form>\n        </div>\n        ) \n    }\n        </div>\n    );\n};\n\nexport default ProfileForm;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}